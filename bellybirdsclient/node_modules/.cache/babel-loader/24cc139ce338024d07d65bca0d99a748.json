{"ast":null,"code":"import _toConsumableArray from\"/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useEffect,useState}from\"react\";import{TextField}from'@material-ui/core';import Banner from\"../Banner\";import'./style.scss';import{useHistory}from\"react-router-dom\";import{store}from\"../../redux\";// import Link from '@material-ui/core/Link';\nimport SendIcon from'@material-ui/icons/Send';var HOST=window.location.hostname+':1338';export default function Chat(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),chatMessage=_useState2[0],setChatMessage=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chatMessages=_useState4[0],setChatMessages=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),wsRef=_useState6[0],setWsRef=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),messagesEnd=_useState8[0],setMessagesEnd=_useState8[1];var history=useHistory();var state=store.getState();// let count = 10;\nvar handleKeyDown=function handleKeyDown(event){if(event.key==='Enter'){sendMessage();}};function processMessage(payload){try{return JSON.parse(payload);}catch(e){return null;}}// function showMore() {\n//   if (wsRef?.readyState !== WebSocket.OPEN) {\n//     // websocket not connected\n//     return;\n//   }\n//   count = count + 10;\n//   wsRef.send(JSON.stringify({ intent: 'old-messages', count: count }));\n// }\nfunction sendMessage(){if((wsRef===null||wsRef===void 0?void 0:wsRef.readyState)!==WebSocket.OPEN){// websocket not connected\nreturn;}wsRef.send(JSON.stringify({message:chatMessage,intent:\"chat\",uname:state.user.uname}));setChatMessage(\"\");// messagesEnd.scrollIntoView({ behavior: \"smooth\" });\n}useEffect(function(){console.log(\"im fired\",document.body.scrollHeight);if(!messagesEnd)return;messagesEnd.scrollIntoView({behavior:\"smooth\"});});useEffect(function(){var ws=new WebSocket(\"ws://\".concat(HOST,\"/\").concat(localStorage.getItem(\"token\")));ws.addEventListener(\"open\",function(){ws.send(JSON.stringify({intent:'old-messages',count:100}));},{once:true});ws.addEventListener(\"error\",function(){history.replace(\"/login\");});ws.addEventListener(\"message\",function(event){var data=event.data;var message=processMessage(data);if(!message)return;console.log(\"message\",message);if(message.intent===\"chat\"){setChatMessages(function(oldMessages){return[].concat(_toConsumableArray(oldMessages),[message]);});}else if(message.intent===\"old-messages\"){console.log(\"old-messages\",message.data);setChatMessages(message.data.reverse());}});setWsRef(ws);return function(){ws.close();};},[history]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsx(Banner,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages\",children:[chatMessages.map(function(message,index){if(message.uname===state.user.uname){return/*#__PURE__*/_jsx(\"div\",{className:\"chat__messages__item active\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages__item__wrapper--active\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author\",children:[message.uname,\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:message.message})]})},index);}else{return/*#__PURE__*/_jsx(\"div\",{className:\"chat__messages__item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages__item__wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author\",children:[message.uname,\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:message.message})]})},index);}}),/*#__PURE__*/_jsx(\"div\",{style:{\"float\":\"left\",height:\"10px\",clear:\"both\"},ref:function ref(el){return setMessagesEnd(el);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__box\",children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,onKeyDown:handleKeyDown,placeholder:\"Live Chat Here\",label:\"Type Your Message\",onChange:function onChange(e){return setChatMessage(e.target.value);},value:chatMessage,variant:\"outlined\"}),/*#__PURE__*/_jsx(\"div\",{className:\"chat__box__send\",role:\"button\",children:/*#__PURE__*/_jsx(SendIcon,{fontSize:\"large\",onClick:sendMessage})})]})]})]});}","map":{"version":3,"sources":["/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/src/components/Chat/index.tsx"],"names":["React","useEffect","useState","TextField","Banner","useHistory","store","SendIcon","HOST","window","location","hostname","Chat","chatMessage","setChatMessage","chatMessages","setChatMessages","wsRef","setWsRef","messagesEnd","setMessagesEnd","history","state","getState","handleKeyDown","event","key","sendMessage","processMessage","payload","JSON","parse","e","readyState","WebSocket","OPEN","send","stringify","message","intent","uname","user","console","log","document","body","scrollHeight","scrollIntoView","behavior","ws","localStorage","getItem","addEventListener","count","once","replace","data","oldMessages","reverse","close","map","index","height","clear","el","target","value"],"mappings":"4fAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,SAAT,KAA0B,mBAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CACA,MAAO,cAAP,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,KAAT,KAAsB,aAAtB,CACA;AACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,CAWA,GAAMC,CAAAA,IAAI,CAAGC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAA2B,OAAxC,CAEA,cAAe,SAASC,CAAAA,IAAT,EAAgB,eAESV,QAAQ,CAAS,EAAT,CAFjB,wCAEtBW,WAFsB,eAETC,cAFS,8BAGWZ,QAAQ,CAAiB,EAAjB,CAHnB,yCAGtBa,YAHsB,eAGRC,eAHQ,8BAIHd,QAAQ,CAAmB,IAAnB,CAJL,yCAItBe,KAJsB,eAIfC,QAJe,8BAKShB,QAAQ,EALjB,yCAKtBiB,WALsB,eAKTC,cALS,eAO7B,GAAMC,CAAAA,OAAO,CAAGhB,UAAU,EAA1B,CAEA,GAAMiB,CAAAA,KAAU,CAAGhB,KAAK,CAACiB,QAAN,EAAnB,CAGA;AAEA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,KAAD,CAAgB,CACpC,GAAIA,KAAK,CAACC,GAAN,GAAc,OAAlB,CAA2B,CACzBC,WAAW,GACZ,CACF,CAJD,CAOA,QAASC,CAAAA,cAAT,CAAwBC,OAAxB,CAAyC,CACvC,GAAI,CACF,MAAOC,CAAAA,IAAI,CAACC,KAAL,CAAWF,OAAX,CAAP,CACD,CAAC,MAAOG,CAAP,CAAU,CACV,MAAO,KAAP,CACD,CACF,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,QAASL,CAAAA,WAAT,EAAuB,CACrB,GAAI,CAAAV,KAAK,OAAL,EAAAA,KAAK,SAAL,QAAAA,KAAK,CAAEgB,UAAP,IAAsBC,SAAS,CAACC,IAApC,CAA0C,CACxC;AACA,OACD,CACDlB,KAAK,CAACmB,IAAN,CAAWN,IAAI,CAACO,SAAL,CAAe,CAAEC,OAAO,CAAEzB,WAAX,CAAwB0B,MAAM,CAAE,MAAhC,CAAwCC,KAAK,CAAElB,KAAK,CAACmB,IAAN,CAAWD,KAA1D,CAAf,CAAX,EACA1B,cAAc,CAAC,EAAD,CAAd,CACA;AACD,CAEDb,SAAS,CAAC,UAAM,CACdyC,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAwBC,QAAQ,CAACC,IAAT,CAAcC,YAAtC,EACA,GAAG,CAAC3B,WAAJ,CAAiB,OACjBA,WAAW,CAAC4B,cAAZ,CAA2B,CAAEC,QAAQ,CAAE,QAAZ,CAA3B,EACD,CAJQ,CAAT,CAMA/C,SAAS,CAAC,UAAM,CACd,GAAMgD,CAAAA,EAAE,CAAG,GAAIf,CAAAA,SAAJ,gBAAsB1B,IAAtB,aAA8B0C,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA9B,EAAX,CAEAF,EAAE,CAACG,gBAAH,CAAoB,MAApB,CAA4B,UAAM,CAChCH,EAAE,CAACb,IAAH,CAAQN,IAAI,CAACO,SAAL,CAAe,CAAEE,MAAM,CAAE,cAAV,CAA0Bc,KAAK,CAAE,GAAjC,CAAf,CAAR,EACD,CAFD,CAEG,CAAEC,IAAI,CAAE,IAAR,CAFH,EAIAL,EAAE,CAACG,gBAAH,CAAoB,OAApB,CAA6B,UAAM,CACjC/B,OAAO,CAACkC,OAAR,CAAgB,QAAhB,EACD,CAFD,EAIAN,EAAE,CAACG,gBAAH,CAAoB,SAApB,CAA+B,SAAC3B,KAAD,CAAW,CACxC,GAAM+B,CAAAA,IAAI,CAAG/B,KAAK,CAAC+B,IAAnB,CACA,GAAMlB,CAAAA,OAAY,CAAGV,cAAc,CAAC4B,IAAD,CAAnC,CACA,GAAI,CAAClB,OAAL,CAAc,OACdI,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuBL,OAAvB,EACA,GAAIA,OAAO,CAACC,MAAR,GAAmB,MAAvB,CAA+B,CAC7BvB,eAAe,CAAC,SAAAyC,WAAW,qCAAQA,WAAR,GAAqBnB,OAArB,IAAZ,CAAf,CACD,CAFD,IAEO,IAAIA,OAAO,CAACC,MAAR,GAAmB,cAAvB,CAAuC,CAC5CG,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BL,OAAO,CAACkB,IAApC,EACAxC,eAAe,CAACsB,OAAO,CAACkB,IAAR,CAAaE,OAAb,EAAD,CAAf,CACD,CAEF,CAZD,EAcAxC,QAAQ,CAAC+B,EAAD,CAAR,CAEA,MAAO,WAAM,CACXA,EAAE,CAACU,KAAH,GACD,CAFD,CAID,CA/BQ,CA+BN,CAACtC,OAAD,CA/BM,CAAT,CAiCA,mBACE,aAAK,SAAS,CAAC,MAAf,wBACE,KAAC,MAAD,IADF,cAGE,aAAK,SAAS,CAAC,eAAf,wBACE,aAAK,SAAS,CAAC,gBAAf,WAIIN,YAAY,CAAC6C,GAAb,CAAiB,SAACtB,OAAD,CAAUuB,KAAV,CAAoB,CACnC,GAAIvB,OAAO,CAACE,KAAR,GAAkBlB,KAAK,CAACmB,IAAN,CAAWD,KAAjC,CAAwC,CACtC,mBAAQ,YAAK,SAAS,CAAC,6BAAf,uBACN,aAAK,SAAS,CAAC,uCAAf,wBACE,aAAK,SAAS,CAAC,QAAf,WAAyBF,OAAO,CAACE,KAAjC,OADF,cAEE,YAAK,SAAS,CAAC,SAAf,UAA0BF,OAAO,CAACA,OAAlC,EAFF,GADM,EAAkDuB,KAAlD,CAAR,CAMD,CAPD,IAOO,CACL,mBAAQ,YAAK,SAAS,CAAC,sBAAf,uBACN,aAAK,SAAS,CAAC,+BAAf,wBACE,aAAK,SAAS,CAAC,QAAf,WAAyBvB,OAAO,CAACE,KAAjC,OADF,cAEE,YAAK,SAAS,CAAC,SAAf,UAA0BF,OAAO,CAACA,OAAlC,EAFF,GADM,EAA2CuB,KAA3C,CAAR,CAMD,CAGF,CAlBD,CAJJ,cAuBK,YAAK,KAAK,CAAE,CAAE,QAAM,MAAR,CAAgBC,MAAM,CAAE,MAAxB,CAAgCC,KAAK,CAAE,MAAvC,CAAZ,CACA,GAAG,CAAE,aAACC,EAAD,QAAQ5C,CAAAA,cAAc,CAAC4C,EAAD,CAAtB,EADL,EAvBL,GADF,cA4BE,aAAK,SAAS,CAAC,WAAf,wBACE,KAAC,SAAD,EAAW,SAAS,KAApB,CAAqB,SAAS,CAAExC,aAAhC,CAA+C,WAAW,CAAC,gBAA3D,CAA4E,KAAK,CAAC,mBAAlF,CAAsG,QAAQ,CAAE,kBAACQ,CAAD,QAAYlB,CAAAA,cAAc,CAACkB,CAAC,CAACiC,MAAF,CAASC,KAAV,CAA1B,EAAhH,CAA4J,KAAK,CAAErD,WAAnK,CAAgL,OAAO,CAAC,UAAxL,EADF,cAEE,YAAK,SAAS,CAAC,iBAAf,CAAiC,IAAI,CAAC,QAAtC,uBAA+C,KAAC,QAAD,EAAU,QAAQ,CAAC,OAAnB,CAA2B,OAAO,CAAEc,WAApC,EAA/C,EAFF,GA5BF,GAHF,GADF,CAuCD","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { TextField } from '@material-ui/core';\nimport Banner from \"../Banner\";\nimport './style.scss';\nimport { useHistory } from \"react-router-dom\";\nimport { store } from \"../../redux\";\n// import Link from '@material-ui/core/Link';\nimport SendIcon from '@material-ui/icons/Send';\n\n\ntype Message = {\n  email: string;\n  uname: string;\n  message: string;\n  intent: string;\n  //ToDO: date\n}\n\nconst HOST = window.location.hostname + ':1338';\n\nexport default function Chat() {\n\n  const [chatMessage, setChatMessage] = useState<string>(\"\");\n  const [chatMessages, setChatMessages] = useState<Array<Message>>([]);\n  const [wsRef, setWsRef] = useState<null | WebSocket>(null);\n  const [messagesEnd, setMessagesEnd] = useState<any>();\n\n  const history = useHistory();\n\n  const state: any = store.getState();\n\n\n  // let count = 10;\n\n  const handleKeyDown = (event: any) => {\n    if (event.key === 'Enter') {\n      sendMessage();\n    }\n  }\n\n\n  function processMessage(payload: string) {\n    try {\n      return JSON.parse(payload);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  // function showMore() {\n  //   if (wsRef?.readyState !== WebSocket.OPEN) {\n  //     // websocket not connected\n  //     return;\n  //   }\n  //   count = count + 10;\n  //   wsRef.send(JSON.stringify({ intent: 'old-messages', count: count }));\n  // }\n\n  function sendMessage() {\n    if (wsRef?.readyState !== WebSocket.OPEN) {\n      // websocket not connected\n      return;\n    }\n    wsRef.send(JSON.stringify({ message: chatMessage, intent: \"chat\", uname: state.user.uname }))\n    setChatMessage(\"\");\n    // messagesEnd.scrollIntoView({ behavior: \"smooth\" });\n  }\n\n  useEffect(() => {\n    console.log(\"im fired\", document.body.scrollHeight)\n    if(!messagesEnd) return;\n    messagesEnd.scrollIntoView({ behavior: \"smooth\" });\n  });\n\n  useEffect(() => {\n    const ws = new WebSocket(`ws://${HOST}/${localStorage.getItem(\"token\")}`);\n\n    ws.addEventListener(\"open\", () => {\n      ws.send(JSON.stringify({ intent: 'old-messages', count: 100 }));\n    }, { once: true });\n\n    ws.addEventListener(\"error\", () => {\n      history.replace(\"/login\");\n    })\n\n    ws.addEventListener(\"message\", (event) => {\n      const data = event.data;\n      const message: any = processMessage(data);\n      if (!message) return\n      console.log(\"message\", message)\n      if (message.intent === \"chat\") {\n        setChatMessages(oldMessages => [...oldMessages, message as Message]);\n      } else if (message.intent === \"old-messages\") {\n        console.log(\"old-messages\", message.data);\n        setChatMessages(message.data.reverse());\n      }\n\n    })\n\n    setWsRef(ws);\n\n    return () => {\n      ws.close();\n    }\n\n  }, [history])\n\n  return (\n    <div className=\"chat\">\n      <Banner></Banner>\n      {/* <h2>Live Chat</h2> */}\n      <div className=\"chat__wrapper\">\n        <div className=\"chat__messages\">\n          {/* <Link component=\"button\" onClick={showMore}>Show More</Link> */}\n\n          {\n            chatMessages.map((message, index) => {\n              if (message.uname === state.user.uname) {\n                return (<div className=\"chat__messages__item active\" key={index}>\n                  <div className=\"chat__messages__item__wrapper--active\">\n                    <div className=\"author\">{message.uname}:</div>\n                    <div className=\"message\">{message.message}</div>\n                  </div>\n                </div>)\n              } else {\n                return (<div className=\"chat__messages__item\" key={index}>\n                  <div className=\"chat__messages__item__wrapper\">\n                    <div className=\"author\">{message.uname}:</div>\n                    <div className=\"message\">{message.message}</div>\n                  </div>\n                </div>)\n              }\n\n\n            })}\n             <div style={{ float:\"left\", height: \"10px\", clear: \"both\" }}\n             ref={(el) => setMessagesEnd(el) }>\n            </div>\n        </div>\n        <div className=\"chat__box\">\n          <TextField fullWidth onKeyDown={handleKeyDown} placeholder=\"Live Chat Here\" label=\"Type Your Message\" onChange={(e: any) => setChatMessage(e.target.value)} value={chatMessage} variant=\"outlined\" />\n          <div className=\"chat__box__send\" role=\"button\"><SendIcon fontSize=\"large\" onClick={sendMessage}></SendIcon></div>\n        </div>\n      </div>\n    </div>\n  )\n}"]},"metadata":{},"sourceType":"module"}