{"ast":null,"code":"import _toConsumableArray from\"/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useEffect,useState}from\"react\";import{TextField,Button}from'@material-ui/core';import{useButtonStyles}from\"../../RootStyles\";import Banner from\"../Banner\";import'./style.scss';import{useHistory}from\"react-router-dom\";import{store}from\"../../redux\";import Link from'@material-ui/core/Link';var HOST=window.location.hostname+':1338';export default function Chat(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),chatMessage=_useState2[0],setChatMessage=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chatMessages=_useState4[0],setChatMessages=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),wsRef=_useState6[0],setWsRef=_useState6[1];var buttonclasses=useButtonStyles();var history=useHistory();var state=store.getState();var count=10;var handleKeyDown=function handleKeyDown(event){if(event.key==='Enter'){sendMessage();}};function processMessage(payload){try{return JSON.parse(payload);}catch(e){return null;}}function showMore(){if((wsRef===null||wsRef===void 0?void 0:wsRef.readyState)!==WebSocket.OPEN){// websocket not connected\nreturn;}count=count+10;wsRef.send(JSON.stringify({intent:'old-messages',count:count}));}function sendMessage(){if((wsRef===null||wsRef===void 0?void 0:wsRef.readyState)!==WebSocket.OPEN){// websocket not connected\nreturn;}wsRef.send(JSON.stringify({message:chatMessage,intent:\"chat\",uname:state.user.uname}));setChatMessage(\"\");}useEffect(function(){var ws=new WebSocket(\"ws://\".concat(HOST,\"/\").concat(localStorage.getItem(\"token\")));ws.addEventListener(\"open\",function(){ws.send(JSON.stringify({intent:'old-messages',count:100}));},{once:true});ws.addEventListener(\"error\",function(){history.replace(\"/login\");});ws.addEventListener(\"message\",function(event){var data=event.data;var message=processMessage(data);if(!message)return;console.log(\"message\",message);if(message.intent===\"chat\"){setChatMessages(function(oldMessages){return[].concat(_toConsumableArray(oldMessages),[message]);});}else if(message.intent===\"old-messages\"){console.log(\"old-messages\",message.data);setChatMessages(message.data.reverse());}});setWsRef(ws);return function(){ws.close();};},[history]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsx(Banner,{}),/*#__PURE__*/_jsx(\"h2\",{children:\"Live Chat\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages\",children:[/*#__PURE__*/_jsx(Link,{component:\"button\",onClick:showMore,children:\"Show More\"}),chatMessages.map(function(message,index){if(message.uname===state.user.uname){return/*#__PURE__*/_jsx(\"div\",{className:\"chat__messages__item active\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages__item__wrapper--active\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author\",children:[message.uname,\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:message.message})]})},index);}else{return/*#__PURE__*/_jsx(\"div\",{className:\"chat__messages__item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat__messages__item__wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author\",children:[message.uname,\":\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:message.message})]})},index);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__box\",children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,onKeyDown:handleKeyDown,placeholder:\"Your Message Here\",label:\"Type Your Message\",onChange:function onChange(e){return setChatMessage(e.target.value);},value:chatMessage,variant:\"outlined\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{fullWidth:true,className:buttonclasses.secondary,onClick:sendMessage,color:\"default\",children:\"Send Message\"})]})]})]});}","map":{"version":3,"sources":["/Users/saikrishnareddymudhiganti/Desktop/MyProjects/projects/bellybird/bellybirdsclient/src/components/Chat/index.tsx"],"names":["React","useEffect","useState","TextField","Button","useButtonStyles","Banner","useHistory","store","Link","HOST","window","location","hostname","Chat","chatMessage","setChatMessage","chatMessages","setChatMessages","wsRef","setWsRef","buttonclasses","history","state","getState","count","handleKeyDown","event","key","sendMessage","processMessage","payload","JSON","parse","e","showMore","readyState","WebSocket","OPEN","send","stringify","intent","message","uname","user","ws","localStorage","getItem","addEventListener","once","replace","data","console","log","oldMessages","reverse","close","map","index","target","value","secondary"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { TextField, Button } from '@material-ui/core';\nimport { useButtonStyles } from \"../../RootStyles\"\nimport Banner from \"../Banner\";\nimport './style.scss';\nimport { useHistory } from \"react-router-dom\";\nimport { store } from \"../../redux\";\nimport Link from '@material-ui/core/Link';\n\n\ntype Message = {\n  email: string;\n  uname: string;\n  message: string;\n  intent: string;\n  //ToDO: date\n}\n\nconst HOST = window.location.hostname + ':1338';\n\nexport default function Chat() {\n\n  const [chatMessage, setChatMessage] = useState<string>(\"\");\n  const [chatMessages, setChatMessages] = useState<Array<Message>>([]);\n  const [wsRef, setWsRef] = useState<null | WebSocket>(null);\n\n  const buttonclasses = useButtonStyles();\n\n  const history = useHistory();\n\n  const state: any = store.getState();\n\n\n  let count = 10;\n\n  const handleKeyDown = (event: any) => {\n    if (event.key === 'Enter') {\n      sendMessage();\n    }\n  }\n\n\n  function processMessage(payload: string) {\n    try {\n      return JSON.parse(payload);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  function showMore() {\n    if (wsRef?.readyState !== WebSocket.OPEN) {\n      // websocket not connected\n      return;\n    }\n    count = count + 10;\n    wsRef.send(JSON.stringify({ intent: 'old-messages', count: count }));\n  }\n\n  function sendMessage() {\n    if (wsRef?.readyState !== WebSocket.OPEN) {\n      // websocket not connected\n      return;\n    }\n    wsRef.send(JSON.stringify({ message: chatMessage, intent: \"chat\", uname: state.user.uname }))\n    setChatMessage(\"\");\n  }\n\n  useEffect(() => {\n    const ws = new WebSocket(`ws://${HOST}/${localStorage.getItem(\"token\")}`);\n\n    ws.addEventListener(\"open\", () => {\n      ws.send(JSON.stringify({ intent: 'old-messages', count: 100 }));\n    }, { once: true });\n\n    ws.addEventListener(\"error\", () => {\n      history.replace(\"/login\");\n    })\n\n    ws.addEventListener(\"message\", (event) => {\n      const data = event.data;\n      const message: any = processMessage(data);\n      if (!message) return\n      console.log(\"message\", message)\n      if (message.intent === \"chat\") {\n        setChatMessages(oldMessages => [...oldMessages, message as Message]);\n      } else if (message.intent === \"old-messages\") {\n        console.log(\"old-messages\", message.data);\n        setChatMessages(message.data.reverse());\n      }\n\n    })\n\n    setWsRef(ws);\n\n    return () => {\n      ws.close();\n    }\n\n  }, [history])\n\n  return (\n    <div className=\"chat\">\n      <Banner></Banner>\n      <h2>Live Chat</h2>\n      <div className=\"chat__wrapper\">\n        <div className=\"chat__messages\">\n          <Link component=\"button\" onClick={showMore}>Show More</Link>\n\n          {\n            chatMessages.map((message, index) => {\n              if (message.uname === state.user.uname) {\n                return (<div className=\"chat__messages__item active\" key={index}>\n                  <div className=\"chat__messages__item__wrapper--active\">\n                    <div className=\"author\">{message.uname}:</div>\n                    <div className=\"message\">{message.message}</div>\n                  </div>\n                </div>)\n              } else {\n                return (<div className=\"chat__messages__item\" key={index}>\n                  <div className=\"chat__messages__item__wrapper\">\n                    <div className=\"author\">{message.uname}:</div>\n                    <div className=\"message\">{message.message}</div>\n                  </div>\n                </div>)\n              }\n\n\n            })}\n        </div>\n        <div className=\"chat__box\">\n\n          <TextField fullWidth onKeyDown={handleKeyDown} placeholder=\"Your Message Here\" label=\"Type Your Message\" onChange={(e: any) => setChatMessage(e.target.value)} value={chatMessage} variant=\"outlined\" />\n          <br />\n          <Button fullWidth className={buttonclasses.secondary} onClick={sendMessage} color=\"default\" >Send Message</Button>\n        </div>\n      </div>\n    </div>\n  )\n}"]},"metadata":{},"sourceType":"module"}